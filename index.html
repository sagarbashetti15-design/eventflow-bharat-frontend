<!DOCTYPE html>
<html lang="kn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EventFlow Bharat</title>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<style>
body{margin:0;font-family:Arial;background:#f7f9fc}
.container{max-width:1200px;margin:auto;padding:20px}
.hero{background:#6c63ff;color:#fff;padding:50px;border-radius:0 0 30px 30px}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;margin-top:30px}
.card{background:#fff;padding:20px;border-radius:16px;box-shadow:0 8px 25px rgba(0,0,0,.1)}
button{background:#6c63ff;color:#fff;border:none;padding:12px;border-radius:10px;width:100%}
select,input{padding:12px;border-radius:10px;width:100%;margin:6px 0}
</style>
</head>

<body>

<div class="hero">
  <div class="container">
    <h1>ಕಾರ್ಯಕ್ರಮಗಳನ್ನು ಹುಡುಕಿ</h1>
    <p>Discover events across Karnataka</p>
    <select id="lang" onchange="loadEvents()">
      <option value="ka">ಕನ್ನಡ</option>
      <option value="en">English</option>
    </select>
  </div>
</div>

<div class="container">
  <select id="city" onchange="loadEvents()">
    <option value="">ಎಲ್ಲಾ ನಗರಗಳು</option>
    <option>Bengaluru</option>
    <option>Mysuru</option>
    <option>Hubballi</option>
  </select>

  <div class="grid" id="events"></div>
</div>

<script>
const API = "https://YOUR-BACKEND-URL.onrender.com";
let selectedEvent = null;

async function loadEvents(){
  const lang = langSelect.value;
  const city = citySelect.value;
  const res = await fetch(API + "/events");
  let data = await res.json();

  if(city) data = data.filter(e => e.city === city);

  events.innerHTML = "";
  data.forEach(e => {
    events.innerHTML += `
      <div class="card">
        <h3>${lang==="ka"?e.title_ka:e.title_en}</h3>
        <p>${e.city}</p>
        <p>₹${e.price}</p>
        <button onclick='book(${JSON.stringify(e)})'>
          ${lang==="ka"?"ಈಗ ಬುಕ್ ಮಾಡಿ":"Book Now"}
        </button>
      </div>
    `;
  });
}

async function book(e){
  selectedEvent = e;
  const key = await fetch(API+"/payment/key").then(r=>r.json());
  const order = await fetch(API+"/payment/order",{
    method:"POST",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({amount:e.price})
  }).then(r=>r.json());

  new Razorpay({
    key:key.key,
    amount:order.amount,
    order_id:order.id,
    handler:async()=>{
      await fetch(API+"/book",{
        method:"POST",
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify(e)
      });
      alert("Booking confirmed!");
    }
  }).open();
}

const events=document.getElementById("events");
const citySelect=document.getElementById("city");
const langSelect=document.getElementById("lang");

loadEvents();
</script>

</body>
</html>
