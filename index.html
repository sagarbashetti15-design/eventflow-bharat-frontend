<!DOCTYPE html>
<html lang="kn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>EventFlow Bharat | ‡≤ï‡≤æ‡≤∞‡≥ç‡≤Ø‡≤ï‡≥ç‡≤∞‡≤Æ‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤π‡≥Å‡≤°‡≥Å‡≤ï‡≤ø</title>
<meta name="description" content="EventFlow Bharat ‚Äì Karnataka‚Äôs trusted event booking platform">

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<style>
/* ---------- BASE ---------- */
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter,Arial,sans-serif;
  background:#f7f9fc;
  color:#1f2937;
}
.container{
  max-width:1200px;
  margin:auto;
  padding:20px;
}
h1,h2,h3{margin:0}
button{
  background:#6c63ff;
  color:#fff;
  border:none;
  padding:14px;
  border-radius:12px;
  font-weight:600;
  cursor:pointer;
}
input,select{
  padding:14px;
  border-radius:12px;
  border:1px solid #ccc;
  width:100%;
  margin:6px 0;
}

/* ---------- HERO ---------- */
.hero{
  background:linear-gradient(135deg,#6c63ff,#4b47c6);
  color:#fff;
  padding:60px 20px;
  border-radius:0 0 32px 32px;
}
.hero p{opacity:.9}

/* ---------- FILTERS ---------- */
.filters{
  display:grid;
  grid-template-columns:2fr 1fr 1fr;
  gap:12px;
  margin-top:20px;
}
@media(max-width:768px){
  .filters{grid-template-columns:1fr}
}

/* ---------- EVENTS ---------- */
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:20px;
  margin-top:30px;
}
.card{
  background:#fff;
  border-radius:18px;
  box-shadow:0 12px 30px rgba(0,0,0,.08);
  padding:20px;
  transition:.3s;
}
.card:hover{transform:translateY(-6px)}
.price{color:#6c63ff;font-weight:700}

/* ---------- MODAL ---------- */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.45);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:1000;
}
.modal-box{
  background:#fff;
  width:90%;
  max-width:420px;
  padding:24px;
  border-radius:18px;
}

/* ---------- FOOTER ---------- */
footer{
  background:#fff;
  margin-top:60px;
  padding:30px;
  text-align:center;
  font-size:14px;
}
</style>
</head>

<body>

<!-- HERO -->
<div class="hero">
  <div class="container">
    <h1 id="t-title">‡≤ï‡≤æ‡≤∞‡≥ç‡≤Ø‡≤ï‡≥ç‡≤∞‡≤Æ‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤π‡≥Å‡≤°‡≥Å‡≤ï‡≤ø</h1>
    <p id="t-sub">‡≤ï‡≤∞‡≥ç‡≤®‡≤æ‡≤ü‡≤ï‡≤¶ ‡≤µ‡≤ø‡≤∂‡≥ç‡≤µ‡≤æ‡≤∏‡≤æ‡≤∞‡≥ç‡≤π ‡≤á‡≤µ‡≥Ü‡≤Ç‡≤ü‡≥ç ‡≤¨‡≥Å‡≤ï‡≥ç‡≤ï‡≤ø‡≤Ç‡≤ó‡≥ç ‡≤µ‡≥á‡≤¶‡≤ø‡≤ï‡≥Ü</p>

    <div class="filters">
      <input id="search" placeholder="‡≤ï‡≤æ‡≤∞‡≥ç‡≤Ø‡≤ï‡≥ç‡≤∞‡≤Æ ‡≤π‡≥Å‡≤°‡≥Å‡≤ï‡≤ø / Search event">
      <select id="city">
        <option value="">‡≤é‡≤≤‡≥ç‡≤≤‡≤æ ‡≤®‡≤ó‡≤∞‡≤ó‡≤≥‡≥Å</option>
        <option>Bengaluru</option>
        <option>Mysuru</option>
        <option>Hubballi</option>
        <option>Dharwad</option>
        <option>Mangaluru</option>
        <option>Belagavi</option>
      </select>
      <select id="lang" onchange="switchLang()">
        <option value="ka">‡≤ï‡≤®‡≥ç‡≤®‡≤°</option>
        <option value="en">English</option>
      </select>
    </div>
  </div>
</div>

<!-- EVENTS -->
<div class="container">
  <div class="grid" id="events"></div>
</div>

<!-- BOOKING MODAL -->
<div class="modal" id="modal">
  <div class="modal-box">
    <h3 id="mTitle"></h3>
    <p id="mCity"></p>
    <p class="price" id="mPrice"></p>
    <input id="name" placeholder="‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ ‡≤π‡≥Ü‡≤∏‡≤∞‡≥Å / Your Name">
    <input id="email" placeholder="Email">
    <input id="phone" placeholder="WhatsApp Number">
    <button onclick="pay()">Pay & Book</button>
  </div>
</div>

<!-- BOOKING HISTORY -->
<div class="container">
  <h2>üìú My Bookings</h2>
  <input id="historyEmail" placeholder="Enter email to view bookings">
  <button onclick="loadHistory()">View</button>
  <div id="history"></div>
</div>

<!-- FOOTER -->
<footer>
  <p>¬© EventFlow Bharat</p>
  <p>Karnataka only | Kannada first üáÆüá≥</p>
</footer>

<script>
const API = "https://eventflow-bharat-backend.onrender.com";

let EVENTS = [];
let selectedEvent = null;
let LANG = "ka";

/* ---------- LOAD EVENTS ---------- */
async function loadEvents(){
  const res = await fetch(API + "/events");
  EVENTS = await res.json();
  render();
}

/* ---------- RENDER ---------- */
function render(){
  const q = search.value.toLowerCase();
  const c = city.value;

  events.innerHTML = "";
  EVENTS.filter(e =>
    (!c || e.city === c) &&
    (e.title_en.toLowerCase().includes(q) ||
     e.title_ka.toLowerCase().includes(q))
  ).forEach(e=>{
    events.innerHTML += `
      <div class="card">
        <h3>${LANG==="ka"?e.title_ka:e.title_en}</h3>
        <p>${e.city}</p>
        <p class="price">‚Çπ${e.price}</p>
        <button onclick='openModal(${JSON.stringify(e)})'>
          ${LANG==="ka"?"‡≤à‡≤ó ‡≤¨‡≥Å‡≤ï‡≥ç ‡≤Æ‡≤æ‡≤°‡≤ø":"Book Now"}
        </button>
      </div>
    `;
  });
}

/* ---------- MODAL ---------- */
function openModal(e){
  selectedEvent = e;
  mTitle.innerText = LANG==="ka"?e.title_ka:e.title_en;
  mCity.innerText = e.city;
  mPrice.innerText = "‚Çπ" + e.price;
  modal.style.display = "flex";
}

/* ---------- PAYMENT ---------- */
async function pay(){
  const key = await fetch(API+"/payment/key").then(r=>r.json());
  const order = await fetch(API+"/payment/order",{
    method:"POST",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({amount:selectedEvent.price})
  }).then(r=>r.json());

  new Razorpay({
    key:key.key,
    amount:order.amount,
    order_id:order.id,
    handler:async()=>{
      await fetch(API+"/book",{
        method:"POST",
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({
          event_id:selectedEvent.id,
          email:email.value,
          phone:phone.value
        })
      });
      alert("üéâ Booking Confirmed");
      modal.style.display="none";
    }
  }).open();
}

/* ---------- HISTORY ---------- */
async function loadHistory(){
  const h = await fetch(API+"/bookings/"+historyEmail.value).then(r=>r.json());
  history.innerHTML = "<pre>"+JSON.stringify(h,null,2)+"</pre>";
}

/* ---------- LANGUAGE ---------- */
function switchLang(){
  LANG = lang.value;
  document.getElementById("t-title").innerText =
    LANG==="ka"?"‡≤ï‡≤æ‡≤∞‡≥ç‡≤Ø‡≤ï‡≥ç‡≤∞‡≤Æ‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤π‡≥Å‡≤°‡≥Å‡≤ï‡≤ø":"Discover Events";
  document.getElementById("t-sub").innerText =
    LANG==="ka"?"‡≤ï‡≤∞‡≥ç‡≤®‡≤æ‡≤ü‡≤ï‡≤¶ ‡≤µ‡≤ø‡≤∂‡≥ç‡≤µ‡≤æ‡≤∏‡≤æ‡≤∞‡≥ç‡≤π ‡≤á‡≤µ‡≥Ü‡≤Ç‡≤ü‡≥ç ‡≤¨‡≥Å‡≤ï‡≥ç‡≤ï‡≤ø‡≤Ç‡≤ó‡≥ç ‡≤µ‡≥á‡≤¶‡≤ø‡≤ï‡≥Ü":
                "Trusted event booking platform in Karnataka";
  render();
}

/* ---------- EVENTS ---------- */
search.oninput = render;
city.onchange = render;
window.onclick = e => { if(e.target === modal) modal.style.display="none"; };

loadEvents();
</script>

</body>
</html>
