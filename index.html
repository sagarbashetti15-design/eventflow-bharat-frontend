<!DOCTYPE html>
<html>
<head>
<title>EventFlow Bharat</title>
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>
<body>

<h2>Events</h2>
<div id="events"></div>

<script>
const API="https://YOUR-BACKEND.onrender.com";

fetch(API+"/events").then(r=>r.json()).then(d=>{
  d.forEach(e=>{
    events.innerHTML+=`
      <div>
        <h3>${e.title}</h3>
        â‚¹${e.price}
        <button onclick="pay(${e.price})">Book</button>
      </div>`;
  });
});

async function pay(price){
  const key=await fetch(API+"/payment/key").then(r=>r.json());
  const order=await fetch(API+"/payment/order",{
    method:"POST",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({amount:price})
  }).then(r=>r.json());

  new Razorpay({
    key:key.key,
    amount:order.amount,
    order_id:order.id,
    handler:()=>fetch(API+"/book",{
      method:"POST",
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({phone:"+91XXXXXXXXXX"})
    }).then(()=>alert("Booked"))
  }).open();
}
</script>
</body>
</html>
